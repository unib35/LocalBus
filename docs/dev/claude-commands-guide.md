# Claude Commands 가이드

이 문서는 LocalBus 프로젝트에서 사용할 수 있는 Claude Code custom commands를 설명합니다.
모든 명령어는 Kent Beck의 TDD 및 Tidy First 원칙을 따릅니다.

## 명령어 목록

### TDD 명령어

| 명령어          | 인자             | 설명                                          |
| --------------- | ---------------- | --------------------------------------------- |
| `/tdd-plan`     | 기능 설명        | 테스트 계획을 작성하고 `plan.md` 생성         |
| `/tdd-status`   | -                | 현재 TDD 진행 상황 (완료/남은 테스트, 진행률) |
| `/tdd-next`     | -                | 다음 구현할 테스트 확인 (구현하지 않음)       |
| `/tdd-go`       | -                | 다음 테스트 구현 (Red → Green 사이클)         |
| `/tdd-test`     | 파일/패턴 (선택) | 테스트 실행 및 결과 분석                      |
| `/tdd-verify`   | -                | 커밋 전 전체 검증 (build, lint, test)         |
| `/tdd-refactor` | 대상 (선택)      | Green 상태에서 리팩토링 수행                  |
| `/tdd-tidy`     | 대상             | Tidy First 원칙에 따른 구조적 변경            |
| `/tdd-fix`      | 결함 설명        | 결함을 TDD 방식으로 수정                      |
| `/tdd-commit`   | 메시지 (선택)    | TDD 원칙에 맞는 커밋 수행                     |

### 프로젝트 명령어

| 명령어       | 인자               | 설명                                 |
| ------------ | ------------------ | ------------------------------------ |
| `/dev-check` | -                  | 프로젝트 상태 확인 (git, 빌드, 테스트) |
| `/dev-setup` | `reset` (선택)     | 개발 환경 설정 및 진단               |
| `/pr-create` | 대상 브랜치 (선택) | TDD 체크리스트 포함 PR 생성          |

---

## 워크플로우

### 1. 새 기능 개발 (Feature Development)

새로운 기능을 TDD로 개발하는 전체 흐름입니다.

```
┌─────────────────────────────────────────────────────────────┐
│  1. 계획 수립                                                │
│     /tdd-plan 다음 버스 자동 포커싱 기능                      │
│     → plan.md 생성                                          │
├─────────────────────────────────────────────────────────────┤
│  2. 개발 사이클 (반복)                                       │
│     ┌──────────────────────────────────────────────────┐    │
│     │  /tdd-status    → 진행 상황 확인                  │    │
│     │  /tdd-next      → 다음 테스트 확인                │    │
│     │  /tdd-go        → Red → Green 구현               │    │
│     │  /tdd-test      → 테스트 통과 확인                │    │
│     │  /tdd-refactor  → 필요시 리팩토링                 │    │
│     └──────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────┤
│  3. 커밋                                                     │
│     /tdd-verify       → 전체 검증                           │
│     /tdd-commit       → 커밋 수행                           │
├─────────────────────────────────────────────────────────────┤
│  4. PR 생성                                                  │
│     /pr-create        → Pull Request 생성                   │
└─────────────────────────────────────────────────────────────┘
```

#### 실제 사용 예시

```bash
# 1. 기능 계획
/tdd-plan 다음 버스 자동 스크롤 - 현재 시간 이후 가장 가까운 버스로 스크롤

# 2. 진행 상황 확인
/tdd-status
# 📊 TDD 진행 상황
# ✅ 완료: 0개 | ⏳ 남음: 5개 | 📈 진행률: 0%
# 🎯 다음: testFindNextBusReturnsNilWhenNoUpcomingBus

# 3. 다음 테스트 미리보기
/tdd-next
# 테스트 위치, 필요한 mock 등 정보 확인

# 4. 테스트 구현
/tdd-go
# Red → Green 사이클 자동 수행

# 5. 반복...
/tdd-status  # 진행률 확인
/tdd-go      # 다음 테스트

# 6. 커밋 전 검증
/tdd-verify

# 7. 커밋
/tdd-commit
```

---

### 2. 버그 수정 (Bug Fix)

버그를 TDD 방식으로 수정하는 흐름입니다.

```
┌─────────────────────────────────────────────────────────────┐
│  1. 결함 수정                                                │
│     /tdd-fix 공휴일에 평일 시간표가 표시되는 문제             │
│     → API 레벨 테스트 작성                                   │
│     → 최소 단위 재현 테스트 작성                             │
│     → 수정 구현                                              │
├─────────────────────────────────────────────────────────────┤
│  2. 검증 및 커밋                                             │
│     /tdd-verify                                              │
│     /tdd-commit                                              │
└─────────────────────────────────────────────────────────────┘
```

#### 핵심 원칙

1. **테스트 없이 코드 수정 금지** - 반드시 재현 테스트 먼저
2. **두 레벨의 테스트** - UI 레벨 + 최소 단위 테스트
3. **회귀 방지** - 기존 테스트 전체 통과 확인

---

### 3. 리팩토링 (Refactoring)

코드 품질 개선을 위한 리팩토링 흐름입니다.

```
┌─────────────────────────────────────────────────────────────┐
│  1. 사전 확인                                                │
│     /tdd-test         → 모든 테스트 통과 확인                │
├─────────────────────────────────────────────────────────────┤
│  2. 구조적 변경 (Tidy First)                                 │
│     /tdd-tidy TimetableViewModel                            │
│     → 이름 변경, 메서드 추출, 파일 분리 등                   │
│     → 행위 변경 없이 구조만 개선                             │
├─────────────────────────────────────────────────────────────┤
│  3. 구조적 변경 커밋                                         │
│     /tdd-commit                                              │
│     → [Refactor] 접두어로 커밋                               │
├─────────────────────────────────────────────────────────────┤
│  4. 행위적 변경 (필요시)                                     │
│     /tdd-go           → 새 기능 테스트 및 구현               │
│     /tdd-commit       → [Feat] 접두어로 별도 커밋            │
└─────────────────────────────────────────────────────────────┘
```

#### Tidy First 원칙

- **구조적 변경**: 행위 변경 없이 코드 정리 (이름, 구조, 위치)
- **행위적 변경**: 실제 기능 추가/수정
- **절대 섞지 않음**: 각각 별도 커밋

---

### 4. 개발 환경 관리

일상적인 개발 환경 관리 명령어입니다.

```bash
# 프로젝트 상태 한눈에 확인
/dev-check

# 개발 환경 초기 설정 또는 문제 진단
/dev-setup

# 클린 빌드가 필요할 때
/dev-setup reset
```

---

## 커밋 컨벤션

TDD commands는 다음 커밋 메시지 형식을 사용합니다:

| 접두어       | 용도                      | 예시                                        |
| ------------ | ------------------------- | ------------------------------------------- |
| `[Feat]`     | 새 기능 (행위적 변경)     | `[Feat]: 다음 버스 자동 스크롤 기능 추가`   |
| `[Fix]`      | 버그 수정 (행위적 변경)   | `[Fix]: 공휴일 시간표 판단 오류 수정`       |
| `[Refactor]` | 리팩토링 (구조적 변경)    | `[Refactor]: TimetableService 메서드 분리`  |
| `[Chore]`    | 설정/의존성 (구조적 변경) | `[Chore]: XCTest 설정 추가`                 |

---

## 주의사항

### TDD 사이클 준수

```
Red → Green → Refactor
 │      │         │
 │      │         └─ 테스트 통과 상태에서만
 │      └─ 최소한의 코드만
 └─ 먼저 실패하는 테스트
```

### plan.md 관리

- `/tdd-plan`으로 생성된 `plan.md`는 프로젝트 루트에 위치
- 완료된 테스트는 `- [x]`로 자동 마킹
- 하나의 기능 완료 후 다음 기능 계획 시 새로 생성

### 커밋 분리

```
❌ 잘못된 예: 리팩토링 + 새 기능을 하나의 커밋에

✅ 올바른 예:
   1. [Refactor]: 기존 코드 정리
   2. [Feat]: 새 기능 추가
```

---

## 참고 자료

- [Kent Beck의 TDD 가이드](./kentback-tdd-guide.md)
- [프로젝트 CLAUDE.md](../../CLAUDE.md)
